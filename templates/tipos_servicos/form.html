{% extends "base.html" %}

{% block title %}{{ 'Editar' if tipo else 'Novo' }} Tipo de Serviço - MeetCall System{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
    <!-- Cabeçalho -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">
            {% if tipo %}
            Editar Tipo de Serviço
            {% else %}
            Novo Tipo de Serviço
            {% endif %}
        </h1>
        <p class="text-gray-600 mt-1">Preencha os dados abaixo</p>
    </div>

    <!-- Formulário -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <form method="POST" id="tipoForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Nome -->
                <div class="md:col-span-2">
                    <label for="nome" class="block text-sm font-medium text-gray-700 mb-2">
                        Nome <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           id="nome" 
                           name="nome" 
                           value="{{ tipo.nome if tipo else '' }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent"
                           required>
                </div>

                <!-- Categoria Pai -->
                <div>
                    <label for="parent_id" class="block text-sm font-medium text-gray-700 mb-2">
                        Categoria Pai
                    </label>
                    <select id="parent_id" 
                            name="parent_id"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent">
                        <option value="">Nenhuma (Categoria Principal)</option>
                        {% for categoria in categorias %}
                        <option value="{{ categoria.id }}" 
                                {% if tipo and tipo.parent_id == categoria.id %}selected{% endif %}>
                            {{ categoria.nome }}
                        </option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">
                        Deixe em branco para criar uma categoria principal
                    </p>
                </div>

                <!-- Tipo (Despesa/Receita) -->
                <div>
                    <label for="tipo" class="block text-sm font-medium text-gray-700 mb-2">
                        Tipo <span class="text-red-500">*</span>
                    </label>
                    <select id="tipo" 
                            name="tipo"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent"
                            required>
                        <option value="despesa" {% if not tipo or tipo.tipo == 'despesa' %}selected{% endif %}>Despesa</option>
                        <option value="receita" {% if tipo and tipo.tipo == 'receita' %}selected{% endif %}>Receita</option>
                    </select>
                </div>

                <!-- Descrição -->
                <div class="md:col-span-2">
                    <label for="descricao" class="block text-sm font-medium text-gray-700 mb-2">
                        Descrição
                    </label>
                    <textarea id="descricao" 
                              name="descricao" 
                              rows="3"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent">{{ tipo.descricao if tipo else '' }}</textarea>
                </div>

                <!-- Alíquota -->
                <div>
                    <label for="aliquota" class="block text-sm font-medium text-gray-700 mb-2">
                        Alíquota (%)
                    </label>
                    <div class="relative">
                        <input type="number" 
                               id="aliquota" 
                               name="aliquota" 
                               value="{{ '%.2f'|format(tipo.aliquota) if tipo else '0.00' }}"
                               step="0.01"
                               min="0"
                               max="100"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent">
                        <span class="absolute right-4 top-2 text-gray-500">%</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        Taxa de impostos aplicada
                    </p>
                </div>

                <!-- Margem Esperada -->
                <div>
                    <label for="margem_esperada" class="block text-sm font-medium text-gray-700 mb-2">
                        Margem Esperada (%)
                    </label>
                    <div class="relative">
                        <input type="number" 
                               id="margem_esperada" 
                               name="margem_esperada" 
                               value="{{ '%.2f'|format(tipo.margem_esperada) if tipo else '0.00' }}"
                               step="0.01"
                               min="0"
                               max="100"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-meetcall-purple focus:border-transparent">
                        <span class="absolute right-4 top-2 text-gray-500">%</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">
                        Margem de lucro esperada
                    </p>
                </div>
            </div>

            <!-- Botões -->
            <div class="flex justify-end space-x-4 mt-8">
                <a href="{{ url_for('tipos_servicos.lista') }}" 
                   class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                    Cancelar
                </a>
                <button type="submit" 
                        class="px-6 py-2 bg-meetcall-purple hover:bg-meetcall-purple-dark text-white rounded-lg transition">
                    <i class="fas fa-save mr-2"></i>
                    {{ 'Atualizar' if tipo else 'Salvar' }}
                </button>
            </div>
        </form>
    </div>

    <!-- Informações Adicionais -->
    {% if tipo %}
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
        <h3 class="text-sm font-medium text-blue-800 mb-2">
            <i class="fas fa-info-circle mr-2"></i>Informações
        </h3>
        <div class="text-sm text-blue-700 space-y-1">
            <p><strong>Código:</strong> {{ tipo.codigo }}</p>
            <p><strong>Criado em:</strong> {{ tipo.created_at.strftime('%d/%m/%Y %H:%M') if tipo.created_at else '-' }}</p>
            {% if tipo.updated_at %}
            <p><strong>Última atualização:</strong> {{ tipo.updated_at.strftime('%d/%m/%Y %H:%M') }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<script>
document.getElementById('tipoForm').addEventListener('submit', function(e) {
    const nome = document.getElementById('nome').value.trim();
    
    if (!nome) {
        e.preventDefault();
        alert('Por favor, preencha o nome do tipo de serviço.');
        return false;
    }
});
</script>
{% endblock %}
